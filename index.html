<meta name="viewport" content="width=device-width,initial-scale=1">

<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous">
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.loadtemplate/1.5.10/jquery.loadTemplate.js" integrity="sha256-867falIbrhHpVSydteOpbJwaSvVuEkNfuNHOROGiIhQ=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/css?family=Playfair+Display&display=swap" rel="stylesheet">

<script type="text/html" id="template">
    <div class="cd-timeline__block">
        <div class="cd-timeline__img cd-timeline__img--picture" data-class="color">
            <i class="material-icons" data-content="icon"></i>
        </div> <!-- cd-timeline__img -->
        
        <div class="cd-timeline__content text-component">
            <h2 data-content="title"></h2>
            <p class="color-contrast-medium" data-content="content"></p>
    
            <div class="flex justify-between items-center">
                <span class="cd-timeline__date" data-content="date"></span>
            </div>
        </div> <!-- cd-timeline__content -->
    </div> <!-- cd-timeline__block -->
</script>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="./timeline.css" rel="stylesheet">

<div class="center-form">
    <h1>AtCoder Achievement</h1>
    <form action="" method="GET">
        <input id="input-name" name="user" type="text" placeholder="erbowl">
        <button id="submit" type="submit">View</button>
    </form>
</div>
<section class="cd-timeline js-cd-timeline">
    <div class="container max-width-lg cd-timeline__container">
    </div>
</section> <!-- cd-timeline -->

<script>
!function(){function e(e){this.element=e,this.blocks=this.element.getElementsByClassName("cd-timeline__block"),this.images=this.element.getElementsByClassName("cd-timeline__img"),this.contents=this.element.getElementsByClassName("cd-timeline__content"),this.offset=.8,this.hideBlocks()}e.prototype.hideBlocks=function(){if(!(!1 in document.documentElement))for(var e,t=this,n=0;n<this.blocks.length;n++)e=n,t.blocks[e].getBoundingClientRect().top>window.innerHeight*t.offset&&(t.images[e].classList.add("cd-timeline__img--hidden"),t.contents[e].classList.add("cd-timeline__content--hidden"))},e.prototype.showBlocks=function(){if(!(!1 in document.documentElement))for(var e,t=this,n=0;n<this.blocks.length;n++)e=n,t.contents[e].classList.contains("cd-timeline__content--hidden")&&t.blocks[e].getBoundingClientRect().top<=window.innerHeight*t.offset&&(t.images[e].classList.add("cd-timeline__img--bounce-in"),t.contents[e].classList.add("cd-timeline__content--bounce-in"),t.images[e].classList.remove("cd-timeline__img--hidden"),t.contents[e].classList.remove("cd-timeline__content--hidden"))};var t,n=document.getElementsByClassName("js-cd-timeline"),i=[],s=!1;if(0<n.length){for(var o=0;o<n.length;o++)t=o,i.push(new e(n[t]));window.addEventListener("scroll",function(e){s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(c):setTimeout(c,250))})}function c(){i.forEach(function(e){e.showBlocks()}),s=!1}}();
</script>

<script>
    $("#input-name").val(getParam("user"));

    $.ajax({
        url: 'https://kenkoooo.com/atcoder/atcoder-api/results?user='+getParam("user"),
        cache: false,
        datatype: 'json',
        success: function(json) {
            {{/*  イベントの作成  */}}
            var events = [];
            var used = {};
            var cnt = 0;
            var first = false;

            json.sort(function(a,b){
                return a.epoch_second - b.epoch_second;
            }).forEach(function(e){
                if(e.result === "AC"){
                    if(!first){
                        events.push({
                            icon: "trending_up",
                            title: "Everything started from here.",
                            content: problemURL(e)+"<br>"+submissionURL(e),
                            date: new Date(e.epoch_second*1000-1),
                            color: "green"
                        });
                        first = true;
                    }

                    cnt++;
                    if(cnt%100==0){
                        events.push({
                            icon: "trending_up",
                            title: "Achieved "+cnt+"AC",
                            content: problemURL(e)+"<br>"+submissionURL(e),
                            date: new Date(e.epoch_second*1000),
                            color: "green"
                        });
                    }

                    if(!used[e.language]){
                        events.push({
                            icon: "star",
                            title: "First AC of "+e.language,
                            content: problemURL(e)+"<br>"+submissionURL(e),
                            date: new Date(e.epoch_second*1000),
                            color: "yellow"
                        });
                        used[e.language] = 0;
                    }else if(used[e.language]%100==0){
                        events.push({
                            icon: "star",
                            title: used[e.language]+"AC by "+e.language,
                            content: problemURL(e)+"<br>"+submissionURL(e),
                            date: new Date(e.epoch_second*1000),
                            color: "yellow"
                        });
                    }
                    used[e.language]++;
                }
            });

            events.sort(function(a,b){
                return b.date - a.date;
            }).forEach(function(e){
                appendContent(e);
            })
        }
    });

    function problemURL(e){
        return "<a href="+"https://atcoder.jp/contests/"+e.contest_id+"/tasks/"+e.problem_id+">"+e.problem_id+"</a>";
    }
    function submissionURL(e){
        return "<a href="+"https://atcoder.jp/contests/"+e.contest_id+"/submissions/"+e.id+">submission link</a>";
    }
    function appendContent(obj){
        $("section > div").loadTemplate(
            $("#template"),
            {
                "icon": obj.icon,
                "title" : obj.title,
                "content": obj.content,
                "date": moment(obj.date).format("YYYY/MM/DD"),
                "color": obj.color
            },
            {
                append: true 
            }
        );
    }
    function getParam(name) {
        url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
</script>
    
<style>
i {
    color: white;
}
.center-form {
    text-align: center;
    padding: 10px 0px;
    background-color: black;
}
.center-form h1 {
    color:  white;
    font-family: 'Playfair Display', serif;
    margin-bottom: 10px;
}

.cd-timeline__block .yellow{
    background-color: yellowgreen;
}
.cd-timeline__block .green{
    background-color: green;
}

#input-name, #submit {
    border-style: none;
    border-radius: 0.25em;
    padding: 0 20px;
    text-align: center;
    height: 25px;
}
#submit {
    background-color: gainsboro;
}

body > section {
    min-height: 100%;
}
p.color-contrast-medium {
    word-break: break-all;
}
@media screen and (max-width:640px) { 
    .cd-timeline__content.text-component {
        overflow: hidden;
    }
}
</style>
